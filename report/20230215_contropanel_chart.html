<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>後臺管理-數據報表</title>
    <link rel="stylesheet" href="../css/bootstrap.min.css">
    <link rel="stylesheet" href="../css/color.css">
    <link rel="stylesheet" href="../css/all.min.css">
</head>

<body>
    <!-- 側邊導覽列 -->
    <nav class="navbar bg-light sticky-top">
        <div class="container-fluid">
            <button class="navbar-toggler me-2" type="button" data-bs-toggle="offcanvas"
                data-bs-target="#offcanvasNavbar" aria-controls="offcanvasNavbar">
                <span class="navbar-toggler-icon"></span>
            </button>
            <a href="../home/front_page.html"><button class="btn btn-outline-dark m-3 me-3">回網站首頁</button></a>
            <a class="navbar-brand fs-3 me-auto fw-bolder" href="#">佩特天旅後臺管理系統</a>
            <div class="offcanvas offcanvas-start" tabindex="-1" id="offcanvasNavbar"
                aria-labelledby="offcanvasNavbarLabel">
                <div class="offcanvas-header">
                    <h5 class="offcanvas-title" id="offcanvasNavbarLabel">佩特天旅後臺管理系統</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
                </div>
                <div class="offcanvas-body">
                    <ul class="navbar-nav justify-content-end flex-grow-1 pe-3">
                        <li class="nav-item">
                            <a class="nav-link" href="../order/order_R.html">訂單確認</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="../room/room_U.html">房型管理</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="../report/20230215_contropanel_chart.html">數據報表</a>
                        </li>
                </div>
            </div>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row ">
            <div class="col-4  mt-3">
                <div class="card h-100">
                    <div class="card-body d-flex align-items-center ">
                        <i class="fa-solid fa-user fa-6x"></i>
                        <div class="text-center w-100">
                            <div class="fs-4 ">會員人數</div>
                            <div class="fs-3 " id="total_member">10,000</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-4  mt-3">
                <div class="card h-100">
                    <div class="card-body d-flex align-items-center ">
                        <i class="fa-solid fa-user fa-6x text-danger"></i>
                        <div class="text-center w-100">
                            <div class="fs-4 ">停權人數</div>
                            <div class="fs-3 " id="userState_n">10,000</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-4  mt-3">
                <div class="card h-100">
                    <div class="card-body d-flex align-items-center text-center">
                        <i class="fa-solid fa-user fa-6x text-success"></i>
                        <div class="text-center w-100">
                            <div class="fs-4 ">啟用人數</div>
                            <div class="fs-3 " id="userState_y">10,000</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-8 mt-3">
                <div class="card">
                    <div class="card-header text-bg-danger text-center">
                        折線圖
                    </div>
                    <div class="card-body">
                        <canvas id="myChart"></canvas>
                    </div>
                </div>
            </div>
            <div class="col-md-4  mt-3">
                <div class="card h-100">
                    <div class="card-header text-bg-danger text-center">
                        圓餅圖
                    </div>
                    <div class="card-body">
                        <canvas id="myChartpie"></canvas>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-8 mt-3">
                <div class="card">
                    <div class="card-header text-bg-danger text-center">
                        長條圖
                    </div>
                    <div class="card-body">
                        <canvas id="myChartline"></canvas>
                    </div>
                </div>
            </div>
        </div>
        <section style="background-color: #498eaf; height: 250px" class="mt-1">
            <div class="container">
                <div class="row">
                    <div class="box0001 col-md-3 mt-4">
                        <h2>會員專區</h2>
                        <ul>
                            <div class="mt-3"><a href="../member/member_R.html" class="h5 text-d">會員中心</a></div>
                            <div class="mt-2">
                                <a href="../member/member_login.html" class="h5 text-d">會員登入</a>
                            </div>
                            <div class="mt-2"><a href="../member/member_R.html" class="h5 text-d">訂房紀錄</a></div>
                            <div class="mt-2">
                                <a href="../member/member_R.html" class="h5 text-d">修改會員資料</a>
                            </div>
                        </ul>
                    </div>

                    <div class="box0001 col-md-5 mt-4">
                        <h2>Google MAP:</h2>
                        <iframe
                            src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3640.034061749506!2d120.60793431317543!3d24.170538178517127!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x34693e048d342aa9%3A0x2b6f18a6783fa3b!2z5Yue5YuV6YOo5Yue5YuV5Yqb55m85bGV572y5Lit5b2w5oqV5YiG572y77yI6Ie65Lit6IG36KiT5bGA77yJ!5e0!3m2!1szh-TW!2stw!4v1678602731779!5m2!1szh-TW!2stw"
                            width="450px" height="150px" allowfullscreen="" loading="lazy"
                            referrerpolicy="no-referrer-when-downgrade"></iframe>
                    </div>

                    <div class="box0001 mt-4 col-md-4">
                        <h2>聯絡資訊</h2>
                        <i class="ms-1 fs-5 fa-solid fa-location-dot"></i>
                        <span class="h5">地址 : 台中市西屯區工業區一路100號</span>
                        <br />
                        <i class="ms-1 mt-3 fs-5 fa-solid fa-phone"></i>
                        <span class="h5">電話 : 04-0000-0000</span>
                        <br />
                        <i class="ms-1 mt-3 fs-5 fa-solid fa-envelope"></i>
                        <span class="h5">Email : test@gmail.com</span>
                        <br />
                        <i class="ms-1 mt-3 fs-5 fa-solid fa-clock"></i>
                        <span class="h5">營業時間 : 09:00-20:00 (全年無休)</span>
                    </div>
                </div>
            </div>
        </section>
        <script src="../js/bootstrap.bundle.min.js"></script>
        <script src="../js/jquery-3.6.1.min.js"></script>
        <script src="../js/check_member_state.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <script>
            let mychart;
            let mychartpie;
            let mychartline;
            $(function () {
                //MUID check
                check_member_state();
                //房型選購統計(長條圖)
                const ctx = document.getElementById('myChart');

                mychart = new Chart(ctx, {
                    type: 'bar',//bar:長條圖 line:折線圖
                    data: {
                        labels: [],//x軸
                        datasets: [{
                            label: '房型選購人數',
                            data: [],//y軸
                            backgroundColor: [
                                'rgba(255, 99, 132,0.6)',
                                'rgba(54, 162, 235,0.6)',
                                'rgba(162, 205, 86,0.6)',
                                'rgba(255, 235, 86,0.6)',
                                'rgba(132, 162, 235,0.6)',
                                'rgba(205, 162, 235,0.6)',
                                'rgba(255, 162, 235,0.6)'
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
                //房型選購統計(圓餅圖)
                const ctxpie = document.getElementById('myChartpie');//線畫圖 下面是控制圖片的參數
                mychartpie = new Chart(ctxpie, {
                    type: 'pie',
                    data: {
                        labels: [],//x軸
                        datasets: [{
                            label: '房型選購人數',
                            data: [],//y軸
                            backgroundColor: [
                                'rgb(255, 99, 132)',
                                'rgb(54, 162, 235)',
                                'rgb(162, 205, 86)',
                                'rgb(255, 235, 86)',
                                'rgb(132, 162, 235)',
                                'rgb(205, 162, 235)',
                                'rgb(255, 162, 235)'
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'top',
                            },
                            title: {
                                display: true,
                                text: '會員居住地分布統計(圓餅圖)'
                            }
                        }
                    },
                });
                //房型選購統計(折線圖)
                const ctxline = document.getElementById('myChartline');

                mychartline = new Chart(ctxline, {
                    type: 'line',//bar:長條圖 line:折線圖
                    data: {
                        labels: [],//x軸
                        datasets: [{
                            label: '房型選購地人數',
                            data: [],//y軸
                            borderWidth: 1
                        }]
                    },
                    options: {
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });

                //房型選購統計
                $.ajax({
                    type: "GET",
                    url: "mem_contar_ORprice.php",
                    dataType: "json",
                    success: showdata_count_ORprice,
                    error: function () {
                        alert("err-mem_contar_state.php");
                    }
                })

                //會員狀態統計
                $.ajax({
                    type: "GET",
                    url: "mem_contar_state.php",
                    dataType: "json",
                    success: showdata_count_userstate,
                    error: function () {
                        alert("err-mem_contar_state.php");
                    }
                })

                //會員人數統計
                $.ajax({
                    type: "GET",
                    url: "mem_R_num_api.php",
                    dataType: "json",
                    success: showdata_total_member,
                    error: function () {
                        alert("err-mem_R_api.php");
                    }
                })
            })

            function showdata_count_ORprice(data) {
                console.log(data);
                data.data.forEach(function (item) {
                    console.log(item.ORname + item.ORprice);

                    //更新長條圖
                    //mychart 自己設的
                    //mychart裡面的data,data下面的labels,用push()的方式把值放進去
                    //因是陣列的原因 所以要用push()
                    mychart.data.labels.push(item.ORname);
                    //第0筆裡面的data這個種類
                    mychart.data.datasets[0].data.push(item.ORprice);

                    //更新圓餅圖
                    mychartpie.data.labels.push(item.ORname);
                    mychartpie.data.datasets[0].data.push(item.ORprice);

                    //更新折線圖
                    mychartline.data.labels.push(item.ORname);
                    mychartline.data.datasets[0].data.push(item.ORprice);

                })
                //強制他更新
                mychart.update();
                mychartpie.update();
                mychartline.update();
            }

            function showdata_count_userstate(data) {
                console.log(data);
                console.log(data.data);

                //停權人數:0 啟用人數:0
                if (data.data.length == 1) {
                    if (data.data[0].UserState != undefined && data.data[0].UserState == 'n') {
                        $("#userState_y").text(0);
                        $("#userState_n").text(data.data[0].num);
                    } else {
                        $("#userState_y").text(data.data[0].num);
                        $("#userState_n").text(0);
                    }
                } else {
                    $("#userState_n").text(data.data[0].num);
                    $("#userState_y").text(data.data[1].num);
                }


            }
            function showdata_total_member(data) {
                console.log(data);
                console.log(data.data[0].total_member);
                $("#total_member").text(data.data[0].total_member);

            }
            //form w3c
            function setCookie(cname, cvalue, exdays) {
                const d = new Date();
                d.setTime(d.getTime() + exdays * 24 * 60 * 1000);
                let expires = "expires=" + d.toUTCString();
                document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
            }

            function getCookie(cname) {
                let name = cname + "=";
                let decodedCookie = decodeURIComponent(document.cookie);
                let ca = decodedCookie.split(";");
                for (let i = 0; i < ca.length; i++) {
                    let c = ca[i];
                    while (c.charAt(0) == " ") {
                        c = c.substring(1);
                    }
                    if (c.indexOf(name) == 0) {
                        return c.substring(name.length, c.length);
                    }
                }
                return "";
            }
        </script>
</body>

</html>